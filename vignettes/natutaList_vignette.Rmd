---
title: "Introduction to naturaList R Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{natutaList_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


The `naturaList` Package offers tools that allow to classify occurrence records up 
to six confidence levels in species identification. This classification aid the user
to selected reliable occurrence information and to find for inconsistencies in 
occurrence data. 

The main function of `naturaList` is `classify_occ()`. This function needs a occurrence
records data and a list of known specialist in the taxa. Both data shold be provided by the user. 
`naturaList` have a dataset for occurence records of the tree fern *Alsophila setosa*, 
and a list of specialists in brazilian ferns and lichophytes. These datasets will be used
as example in the `naturaList` Package. 

Occurence records for *Alsophila setosa* were obtained from 
[GBIF](https://doi.org/10.15468/dl.6jesg0) in 8th July 2019. The `A.setosa` 
dataset in the package is the raw dataset downloaded from GBIF, i.e. this dataset 
contains errors in coordinates and occurrence records without coordinates. The 
functions in `naturaList` assumes that coordinates are correct, but exclude occurrences
without coordinates. The dataset of specialists contains the last name, names and abbreviations for the names, separated in collumns (see `?speciaLists`). 

With these two datasets in hands we can start the classification. 

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```

```{r setup}
# Load package and data
library(naturaList)
data("A.setosa")
data("speciaLists")

# see the size of datasets
dim(A.setosa) # see ?A.setosa
dim(speciaLists) # see ?speciaLists
```

First, we will classify the occurrence records in six confidence levels of species identification. 
The defalt order of confidence levels is:

 * Level 1 - species was identified by a specialist;
 * Level 2 - species was identified by a non-specialist;
 * Level 3 - occurrence record has an image associated;
 * Level 4 - the specimen is preserved in a scientific colection;
 * Level 5 - the identification was done in filed observation;
 * Level 6 - no criteria was met.
 
 Nevertheless, the user can specify the levels order, depending on his/her 
 objetives, except for the Level 1 that always is the specialist identification. 
 
 Let's classify the occurence records with `classify_occ()`:
 
```{r classify, eval=F, echo = T}
occ.class <- classify_occ(A.setosa, speciaLists)
y
y
y
y

dim(occ.class)
# [1] 323 46
```
 
When the name of who identified the species do not perfect match with specialists
names, the function asks if the name represents a specialist. Then the user must
type `y` or `n` to answer yes or no for each umbiguos name. In our example, 
this checking procedure is needed in 4 occurrences. All of them were identified 
by at least one specialist. Because this the code have 4 lines with `y`. 

The classified (`occ.class`) dataset was reduced to 323 occurrences from 508 
from the original dataset (`A.setosa`), because occurences without geographic 
coodinates were excluded. 

Check how many occurrences was classified in each level:
```{r levels, eval=F, echo = T}
table(occ.class$naturaList_levels)
#   1_det_by_spec    2_taxonomist         3_image 4_sci_colection 
#              69             218              12              24 
```

With `grid_filter()` you may filter occurrence records inside grid cells in 
order to keep only the highest confidence level in each grid cell. 

As example, we will filter the `occ.class` in square grid cells of 0.5 decimal
degree of side, which is the defalt grid cell size of `grid_filter()`. You can 
provide the height and width of the grid cell in `grid.resolution` argument, or 
provide a raster layer in argument `r` from which the cell is used to filter 
occurrences. 

```{r grid_filter, eval=F}
occ.grid <- grid_filter(occ.class)
dim(occ.grid)
# [1] 102  46
table(occ.grid$naturaList_levels)
#  1_det_by_spec    2_taxonomist         3_image 4_sci_colection 
#             38              58               3               3 
```

Using the `grid_filter()` with cell size of 0.5 decimal degrees, the number of occurrences
was reduced to 102. Althogh, the proportion of occurrences identified by specialists
increased from 21.4 to 37.2%. 

Finally, the `map_module()` function allow the user to visualize the occurrence
records in a interactive map. In this interactive map, the user can click over an
occurence point to see basic information about the record, such as the instituition
who holds the record, who identified the species and when it was identified. 
Also, if a some error is identified, the user could allow that clicking acts to 
delete points. 
